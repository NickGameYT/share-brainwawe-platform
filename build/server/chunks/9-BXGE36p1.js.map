{"version":3,"file":"9-BXGE36p1.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(main-ideas)/signup/_page.server.js","../../../.svelte-kit/adapter-node/nodes/9.js"],"sourcesContent":["import { f as fail, r as redirect } from \"../../../../chunks/index.js\";\nimport { z } from \"zod\";\nimport bcrypt from \"bcrypt\";\nimport jwt from \"jsonwebtoken\";\nimport { J as JWT_SECRET_KEY } from \"../../../../chunks/private.js\";\nimport { d as db } from \"../../../../chunks/prisma.js\";\nconst signupSchema = z.object({\n  name: z.string().trim().min(2, { message: \"Имя слишком короткое\" }),\n  email: z.string().email(),\n  password: z.string().min(4, { message: \"Пароль должен быть не короче 4 символов\" })\n});\nconst actions = {\n  default: async ({ request, cookies }) => {\n    const form = Object.fromEntries(await request.formData());\n    const { data, error, success } = signupSchema.safeParse(form);\n    if (!success) {\n      const errors = error.flatten().fieldErrors;\n      return fail(400, { message: \"Ошибка валидации\", errors });\n    }\n    try {\n      const emailExists = await db.user.findUnique({\n        where: { email: data.email }\n      });\n      if (emailExists) {\n        return fail(400, { message: \"Этот email уже занят!\" });\n      }\n    } catch (_e) {\n      console.log(_e);\n      return fail(500, { message: _e.message });\n    }\n    try {\n      const hashedPassword = await bcrypt.hash(data.password, 12);\n      const user = await db.user.create({\n        data: {\n          name: data.name,\n          email: data.email,\n          password: hashedPassword\n        },\n        omit: {\n          password: true\n        }\n      });\n      const payload = jwt.sign(user, JWT_SECRET_KEY);\n      cookies.set(\"user\", payload, { path: \"/\", secure: true });\n    } catch (_e) {\n      console.log(_e.message);\n      return fail(400, { message: _e.message });\n    }\n    redirect(307, \"/ideas\");\n  }\n};\nexport {\n  actions\n};\n","import * as server from '../entries/pages/(main-ideas)/signup/_page.server.js';\n\nexport const index = 9;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/(main-ideas)/signup/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/(main-ideas)/signup/+page.server.js\";\nexport const imports = [\"_app/immutable/nodes/9.CP53vw25.js\",\"_app/immutable/chunks/scheduler.ChSTGxN4.js\",\"_app/immutable/chunks/index.zzQGVg1l.js\",\"_app/immutable/chunks/forms.CeeC4T9X.js\",\"_app/immutable/chunks/entry.BauIi3_i.js\",\"_app/immutable/chunks/Toaster.svelte_svelte_type_style_lang.BRJiNN0q.js\"];\nexport const stylesheets = [\"_app/immutable/assets/Toaster.DQwrSZtH.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}