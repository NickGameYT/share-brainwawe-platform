{"version":3,"file":"8-BbQ_0WfD.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(main-ideas)/login/_page.server.js","../../../.svelte-kit/adapter-node/nodes/8.js"],"sourcesContent":["import { d as db } from \"../../../../chunks/prisma.js\";\nimport { f as fail, r as redirect } from \"../../../../chunks/index.js\";\nimport { z } from \"zod\";\nimport bcrypt from \"bcrypt\";\nimport jwt from \"jsonwebtoken\";\nimport { J as JWT_SECRET_KEY } from \"../../../../chunks/private.js\";\nconst loginSchema = z.object({\n  email: z.string().email({ message: \"Неверный email\" }).trim(),\n  // Изменено сообщение ошибки\n  password: z.string().min(4, { message: \"Длина пароля меньше 4 символов\" })\n});\nconst actions = {\n  default: async ({ request, cookies }) => {\n    const form = Object.fromEntries(await request.formData());\n    const { data, error, success } = loginSchema.safeParse(form);\n    if (!success) {\n      const errors = error.flatten().fieldErrors;\n      return fail(400, { message: \"Неверный ввод\", errors, values: form });\n    }\n    const user = await db.user.findUnique({\n      where: { email: data.email }\n    });\n    try {\n      if (!user || !await bcrypt.compare(data.password, user.password)) {\n        return fail(400, { message: \"Неверное имя или пароль\", errors: { password: [\"Неверные данные\"] }, values: form });\n      }\n      const payload = jwt.sign(\n        { id: user.id, email: user.email, name: user.name },\n        JWT_SECRET_KEY\n      );\n      cookies.set(\"user\", payload, { path: \"/\", secure: true });\n    } catch (_e) {\n      return fail(400, { message: _e.message, errors: {}, values: form });\n    }\n    redirect(307, \"/ideas\");\n  }\n};\nexport {\n  actions\n};\n","import * as server from '../entries/pages/(main-ideas)/login/_page.server.js';\n\nexport const index = 8;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/(main-ideas)/login/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/(main-ideas)/login/+page.server.js\";\nexport const imports = [\"_app/immutable/nodes/8.CPJkpZ2u.js\",\"_app/immutable/chunks/scheduler.ChSTGxN4.js\",\"_app/immutable/chunks/index.zzQGVg1l.js\",\"_app/immutable/chunks/forms.CeeC4T9X.js\",\"_app/immutable/chunks/entry.BauIi3_i.js\",\"_app/immutable/chunks/Toaster.svelte_svelte_type_style_lang.BRJiNN0q.js\"];\nexport const stylesheets = [\"_app/immutable/assets/Toaster.DQwrSZtH.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":";;;;;;;;AAMA,MAAM,WAAW,GAAG,CAAC,CAAC,MAAM,CAAC;AAC7B,EAAE,KAAK,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,KAAK,CAAC,EAAE,OAAO,EAAE,gBAAgB,EAAE,CAAC,CAAC,IAAI,EAAE;AAC/D;AACA,EAAE,QAAQ,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,OAAO,EAAE,gCAAgC,EAAE;AAC3E,CAAC,CAAC;AACF,MAAM,OAAO,GAAG;AAChB,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK;AAC3C,IAAI,MAAM,IAAI,GAAG,MAAM,CAAC,WAAW,CAAC,MAAM,OAAO,CAAC,QAAQ,EAAE,CAAC;AAC7D,IAAI,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC;AAChE,IAAI,IAAI,CAAC,OAAO,EAAE;AAClB,MAAM,MAAM,MAAM,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC,WAAW;AAChD,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,eAAe,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC;AAC1E;AACA,IAAI,MAAM,IAAI,GAAG,MAAM,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC;AAC1C,MAAM,KAAK,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK;AAChC,KAAK,CAAC;AACN,IAAI,IAAI;AACR,MAAM,IAAI,CAAC,IAAI,IAAI,CAAC,MAAM,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE;AACxE,QAAQ,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,yBAAyB,EAAE,MAAM,EAAE,EAAE,QAAQ,EAAE,CAAC,iBAAiB,CAAC,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC;AACzH;AACA,MAAM,MAAM,OAAO,GAAG,GAAG,CAAC,IAAI;AAC9B,QAAQ,EAAE,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE;AAC3D,QAAQ;AACR,OAAO;AACP,MAAM,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,OAAO,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC;AAC/D,KAAK,CAAC,OAAO,EAAE,EAAE;AACjB,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,EAAE,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC;AACzE;AACA,IAAI,QAAQ,CAAC,GAAG,EAAE,QAAQ,CAAC;AAC3B;AACA,CAAC;;;;;;;AClCW,MAAC,KAAK,GAAG;AACrB,IAAI,eAAe;AACP,MAAC,SAAS,GAAG,YAAY,eAAe,KAAK,CAAC,MAAM,OAAO,4BAAqD,CAAC,EAAE;AAEnH,MAAC,SAAS,GAAG;AACb,MAAC,OAAO,GAAG,CAAC,oCAAoC,CAAC,6CAA6C,CAAC,yCAAyC,CAAC,yCAAyC,CAAC,yCAAyC,CAAC,yEAAyE;AACtS,MAAC,WAAW,GAAG,CAAC,4CAA4C;AAC5D,MAAC,KAAK,GAAG;;;;"}